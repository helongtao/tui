var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e};(function(){if("undefined"==typeof jQuery||"undefined"==typeof React)throw new Error("TUI requires jQuery and React.");var e={version:"0.20.3"},t=React.createClass({displayName:"EntityDetail",getInitialState:function(){var e=this.props.entity.fields,t={};for(var a in e){var r=e[a];t[r.field]={message:""}}return{fields:t}},create:function(){var t=this.props.entity;try{if(this.validators()){var a=this.props.backList,r=1,s=this.props.formId,n=t.create,i=n?n.url:"",l=n?n.method:"",o=n?n.callback:"";if(""!==this.refs[t.key].value&&(i=t.update.url,l=t.update.method,o=t.update.callback,r=this.props.currentPage),i&&"function"==typeof o)if(w({text:"正在处理"}),t.ajaxSubmit&&t.ajaxSubmit===!0){var c={method:l||"POST",url:i,dataType:"JSON",success:function(t){w({className:"hide"}),"success"===o(t)?(e.success("保存成功"),$("#"+s+" button[type=reset]").click(),a(!0,r)):e.danger("保存失败")},error:function(t,a,r){throw w({className:"hide"}),e.danger(i+"远程调用异常［"+a+", "+r+"］"),new Error(i+"远程调用异常［"+a+", "+r+"］")}};$("#"+s).ajaxSubmit(c)}else $.ajax({method:l||"POST",url:i,data:$("#"+s).serialize(),dataType:"JSON",success:function(t){w({className:"hide"}),"success"===o(t)?(e.success("保存成功"),$("#"+s+" button[type=reset]").click(),a(!0,r)):e.danger("保存失败")},error:function(t,a,r){throw w({className:"hide"}),e.danger(i+"远程调用异常［"+a+", "+r+"］"),new Error(i+"远程调用异常［"+a+", "+r+"］")}});else w({className:"hide"}),e.danger("保存实体配置有误，使用说明请查看［entity.create和entity.update］")}}catch(d){throw w({className:"hide"}),e.danger("保存实体配置有误，"+d),new Error("保存实体配置有误，"+d)}},validators:function(){for(var t=this.props.entity.fields,a=$("#"+this.props.formId).serializeArray(),r={},s=0,n=0;n<a.length;n++){var i=a[n];r[i.name]=i.value}for(var l in t){var o=t[l],c=o.validators,d=void 0===o.disabled?!1:o.disabled,p=void 0===o.readOnly?!1:o.readOnly;if(!d&&!p&&"object"==typeof c){var h=r[o.field],u=c.notEmpty,m=c.remote,f=this.state.fields;f[o.field].message.length>0&&(f[o.field]={message:""},this.setState({fields:f})),"object"==typeof u&&h.length<1?(f[o.field]={message:u.message||o.text+"不能为空"},this.setState({fields:f}),s++):"object"==typeof m&&$.ajax({type:"GET",async:!1,url:m.url,data:{key:m.data.key,value:o.field===o.field?encodeURI(h):m.data.value},success:function(e){e.valid||(s++,f[o.field]={message:m.message||o.text+"错误"},this.setState({fields:f}))}.bind(this),error:function(t,a,r){throw e.danger("TUI: remote url["+m.url+"]远程调用异常，"+a+", "+r),new Error("TUI: remote url["+m.url+"]远程调用异常，"+a+", "+r)}})}}return 0===s?!0:!1},render:function(){var e="form-horizontal "+this.props.className,t=this.props.entityData,s=this.props.entity.key,n=t?t[s]:"",i="";return this.props.entity.update&&this.props.entity.create&&(i="object"==typeof t&&""!==t[s]?this.props.entity.update.method:this.props.entity.create?this.props.entity.create.method||"POST":"POST"),React.createElement("form",{id:this.props.formId,className:e,encType:"multipart/form-data",method:i},React.createElement("input",{type:"hidden",ref:s,name:s,value:n}),React.createElement("div",{className:"form-group"},React.createElement("a",{href:"javascript:;",className:"col-sm-2",onClick:this.props.backList},React.createElement("i",{className:"fa fa-arrow-left"})," 返回列表")),React.createElement("hr",null),this.props.entity.fields.map(function(e,r){return React.createElement("div",{key:r,className:"form-group"},React.createElement("label",{className:"col-sm-2 control-label"},e.text),React.createElement("div",{className:"col-sm-8"},React.createElement(a,{keyValue:n,field:e,entityData:t,formId:this.props.formId}),React.createElement("span",{className:"tui-error"},this.state.fields[e.field].message)))}.bind(this)),React.createElement(r,{keyValue:n,backList:this.props.backList,create:this.create,update:this.props.entity.update,entityData:t,custom:this.props.entity.custom||[]}))}}),a=React.createClass({displayName:"EntityField",render:function(){var e=this.props.entityData,t=this.props.field,a=t.type||"text",r="",c={type:a,field:t,entityData:e,keyValue:this.props.keyValue};switch(a){case"text":r=React.createElement(s,_extends({},c,{formId:this.props.formId}));break;case"select":r=React.createElement(n,c);break;case"radio":r=React.createElement(i,c);break;case"textarea":r=React.createElement(l,c);break;case"editor":r=React.createElement(o,c);break;default:r=React.createElement(s,c)}return r}}),r=React.createClass({displayName:"EntityHandle",customHandle:function(e){var t=this.props.custom[e.target.dataset.customid].handle(this.props.entityData);t&&"success"===t&&this.props.backList(!0)},render:function(){var e=this.props.entityData,t=this.props.keyValue,a=this.props.update,r="",s=this.props.custom,n=[];void 0===t?r=React.createElement("button",{type:"button",className:"ebtn ebtn-success ebtn-rounded tui-mr5",onClick:this.props.create},"添加"):""!==t&&a&&(a.condition&&"function"==typeof a.condition?"success"===a.condition(e)&&(r=React.createElement("button",{type:"button",className:"ebtn ebtn-success ebtn-rounded tui-mr5",onClick:this.props.create},"保存")):r=React.createElement("button",{type:"button",className:"ebtn ebtn-success ebtn-rounded tui-mr5",onClick:this.props.create},"保存"));for(var i=0;i<s.length;i++){var l=s[i];n.push(React.createElement("button",{type:"button",className:"tui-mr5 "+l.className,onClick:this.customHandle,"data-customid":i},l.text))}return React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-4 col-sm-offset-2"},r,React.createElement("button",{type:"button",className:"ebtn ebtn-default ebtn-rounded tui-mr5",onClick:this.props.backList},"取消"),n,React.createElement("button",{type:"reset",style:{display:"none"}},"重置")))}}),s=React.createClass({displayName:"EntityText",getInitialState:function(){return{value:""}},shouldComponentUpdate:function(e,t){if(e.keyValue!==this.props.keyValue||this.state.value!==t.value){var a=t.value;return this.state.value===t.value&&(a=e.entityData[e.field.field]),this.setState({value:a}),!0}return!1},entityTextChangeHandle:function(e){this.setState({value:e.target.value})},dateFocus:function(t){e.datePicker(t,this.props.formId)},render:function(){var e=this.props.field;this.props.entityData;return"file"!==this.props.type&&""!==this.props.keyValue?"date"===this.props.type?React.createElement("input",{type:"text",className:"form-control",name:e.field,ref:e.field,placeholder:e.placeholder||e.text,value:this.state.value,onFocus:this.dateFocus,onChange:this.entityTextChangeHandle,disabled:e.disabled||!1,readOnly:e.readOnly||!1}):React.createElement("input",{type:this.props.type,className:"form-control",name:e.field,ref:e.field,placeholder:e.placeholder||e.text,value:this.state.value,onChange:this.entityTextChangeHandle,disabled:e.disabled||!1,readOnly:e.readOnly||!1}):React.createElement("input",{type:this.props.type,className:"form-control",name:e.field,ref:e.field,placeholder:e.placeholder||e.text,defaultValue:""})}}),n=React.createClass({displayName:"EntitySelect",getInitialState:function(){return{value:"",options:{rows:[]}}},componentDidMount:function(){var e=this.props.field.options;if("string"==typeof e||e instanceof Array==!1){var t="object"==typeof e,a=t?e.url:e;$.get(a,function(e){if(this.isMounted()){a=this.props.field.options;var a={rows:e,textField:t?a.textField:"text",valueField:t?a.valueField:"value"};this.setState({options:a})}}.bind(this))}},shouldComponentUpdate:function(e,t){if(e.keyValue!==this.props.keyValue||this.state.value!==t.value){var a=t.value;return this.state.value===t.value&&(a=e.entityData[e.field.field]),this.setState({value:a}),!0}return!1},entitySelectChangeHandle:function(e){this.setState({value:e.target.value})},render:function(){var e=this.props.field;return e.options instanceof Array?React.createElement("select",{ref:e.field,name:e.field,className:"form-control",value:this.state.value,onChange:this.entitySelectChangeHandle},e.options.map(function(e,t){return React.createElement("option",{key:t,value:e.value},e.text)}.bind(this))):React.createElement("select",{ref:e.field,name:e.field,className:"form-control",value:this.state.value,onChange:this.entitySelectChangeHandle},this.state.options.rows.map(function(e,t){return React.createElement("option",{key:t,value:e[this.state.options.valueField]},e[this.state.options.textField])}.bind(this)))}}),i=React.createClass({displayName:"EntityRadio",getInitialState:function(){return{value:""}},shouldComponentUpdate:function(e,t){if(e.keyValue!==this.props.keyValue||this.state.value!==t.value){var a=t.value;return this.state.value===t.value&&(a=e.entityData[e.field.field]),this.setState({value:a+""}),!0}return!1},entityRadioChangeHandle:function(e){this.setState({value:e.target.value})},render:function(){var e=this.props.field;return React.createElement("p",null,e.options.map(function(t,a){var r="";return r=""!==this.props.keyValue?React.createElement("input",{checked:this.state.value==t.value,type:"radio",ref:e.field,name:e.field,value:t.value,onChange:this.entityRadioChangeHandle}):React.createElement("input",{type:"radio",ref:e.field,name:e.field,value:t.value}),React.createElement("label",{key:a,className:"radio-inline"},r," ",t.text)}.bind(this)))}}),l=React.createClass({displayName:"EntityTextarea",getInitialState:function(){return{value:""}},shouldComponentUpdate:function(e,t){if(e.keyValue!==this.props.keyValue||this.state.value!==t.value){var a=t.value;return this.state.value===t.value&&(a=e.entityData[e.field.field]),this.setState({value:a}),!0}return!1},entityTextareaChangeHandle:function(e){this.setState({value:e.target.value})},render:function(){var e=this.props.field;return this.props.keyValue?React.createElement("textarea",{rows:"5",className:"form-control",name:e.field,ref:e.field,placeholder:e.text,value:this.state.value,onChange:this.entityTextareaChangeHandle,disabled:e.disabled||!1,readOnly:e.readOnly||!1}):React.createElement("textarea",{rows:"5",className:"form-control",name:e.field,ref:e.field,placeholder:e.text,defaultValue:""})}}),o=React.createClass({displayName:"EntityEditor",getInitialState:function(){return{editor:{}}},shouldComponentUpdate:function(e,t){if(e.keyValue!==this.props.keyValue||this.state.value!==t.value){var a=t.value;this.state.value===t.value&&(a=e.entityData[e.field.field]);var r=this.state.editor;void 0===a&&(a=""),r.setValue(a)}return!1},componentDidMount:function(){if(this.isMounted()){var t=["title","bold","italic","underline","strikethrough","color","|","ol","ul","blockquote","code","table","|","link","image","hr","|","indent","outdent"];try{var a=new Simditor({textarea:$("#"+this.props.field.field),toolbar:t,upload:{url:e.config.simditor.url,params:null,fileKey:"fileDataFileName",connectionCount:3,leaveConfirm:"正在上传文件"}});this.setState({editor:a})}catch(r){e.danger("请引入simdirot相关文件"),console.error("请引入simdirot相关文件")}}},render:function(){var e=this.props.field;return""===this.props.keyValue?React.createElement("textarea",{id:e.field,rows:"5",className:"form-control",name:e.field,ref:e.field,placeholder:e.text}):React.createElement("textarea",{id:e.field,rows:"5",className:"form-control",name:e.field,ref:e.field,placeholder:e.text})}}),c=React.createClass({displayName:"TableComp",getInitialState:function(){var e=this.props.searchbar.searchbarProps,t=this.props.options.pagination;return e.goCreate=this.goCreate,e._pagingClick=this._pagingClick,{formId:this.props.options.formId,isShowEntityDetail:!1,searchbar:React.createElement(d,e),searchbarCols:this.props.searchbar.searchbarCols,toolbar:React.createElement(p,this.props.toolbar.toolbarProps),tableDataProps:{},pagination:"boolean"==typeof t&&t===!0||"undefined"==typeof t?"正在加载分页...":"",currentPage:1,maxSize:"number"==typeof this.props.options.maxSize?this.props.options.maxSize:10}},componentDidMount:function(){this.props.options.url&&this._loadData(1)},componentWillReceiveProps:function(e){e.options.refresh&&this.refresh(this.state.currentPage)},_pagingClick:function(e){e.preventDefault(),this._loadData(e.currentTarget.dataset.page)},backList:function(e,t){$("#find-"+this.state.formId).find(".tui-error").text(""),this.setState({isShowEntityDetail:!1,entityData:{}}),e="boolean"==typeof e?e:!1,e&&this.refresh(t)},refresh:function(e){this._loadData(this.state.currentPage)},changeMaxSize:function(e){this.setState({maxSize:e}),this._loadData(this.state.currentPage,e)},_loadData:function(t,a){w();var r=this.props.options.url,s=this.state.searchbarCols,n=this.props.options.data||{random:Math.random()};n.maxSize=a||this.state.maxSize,n.currentPage=t||1;for(var i=0;i<s.length;i++){var l=s[i].field,o="";switch(s[i].type){case"text":o=$("#"+this.state.formId).find("input[name="+l+"]").val();break;case"radio":o=$("#"+this.state.formId).find("input[name="+l+"]:checked").val();break;default:o=$("#"+this.state.formId).find("[name="+l+"]").val()}o&&(n[l]=o)}"function"==typeof this.props.options.submitBefore&&this.props.options.submitBefore({data:n}),$.ajax({method:this.props.options.method?this.props.options.method:"GET",url:r,contentType:this.props.options.contentType||"application/x-www-form-urlencoded",data:n,dataType:"JSON",success:function(t){if(w({className:"hide"}),"object"!=typeof t||void 0===t.rows||void 0===t.rowCount)throw e.danger("TUI Table 远程调用返回数据格式不正确［未检测到rows，rowCount］"),new Error("TUI Table 远程调用返回数据格式不正确［未检测到rows，rowCount］");if(this.isMounted()){var a=this.props.options.pagination,r={options:this.props.options,isCheckAll:!1},s={rowCount:t.rowCount,currentPage:n.currentPage,maxSize:n.maxSize,_pagingClick:this._pagingClick,changeMaxSize:this.changeMaxSize};this.setState({rows:t.rows,tableDataProps:r,pagination:"boolean"==typeof a&&a===!0||"undefined"==typeof a?React.createElement(f,s):"",currentPage:n.currentPage})}}.bind(this),error:function(t,a,r){throw w({className:"hide"}),e.danger("TUI Table 远程调用异常［"+a+", "+r+"］"),new Error("TUI Table 远程调用异常［"+a+", "+r+"］")}})},deleteHandle:function(t){var a=this.refresh,r={id:"delModal",title:"删除确认",content:'<div class="alert alert-warning">确定要删除该条纪录吗？</div>',confirm:function(){return $.ajax({method:t.method||"get",url:t.url,success:function(r){"success"===t.callback(r)?(e.success("删除成功"),a()):e.danger("删除失败")},error:function(a,s,n){throw $("#"+r.id).modal("hide"),e.danger(t.url+"远程调用异常［"+s+", "+n+"］"),new Error(t.url+"远程调用异常［"+s+", "+n+"］")}}),"success"}};v(r)},findHandle:function(t){w(),$.ajax({method:t.method||"GET",url:t.url,success:function(e){w({className:"hide"}),"function"==typeof t.callback&&(e=t.callback(e)),this.goCreate(e)}.bind(this),error:function(a,r,s){throw w({className:"hide"}),e.danger(t.url+"远程调用异常［"+r+", "+s+"］"),new Error(t.url+"远程调用异常［"+r+", "+s+"］")}})},goCreate:function(t){this.props.entity.create&&this.props.entity.create.handle?this.props.entity.create.handle():"object"==typeof this.props.entity&&this.props.entity.fields instanceof Array?this.setState({isShowEntityDetail:!0,entityData:t}):e.danger("请先添加实体属性，使用说明请看［entity.fields］")},handlerCheckForParent:function(e,t){this.state.rows[e].isCheck=t,this.setState({rows:this.state.rows})},checkAll:function(e){this.state.rows.map(function(t,a){return t.isCheck=e,t}),this.state.tableDataProps.isCheckAll=e,this.setState({rows:this.state.rows,tableDataProps:this.state.tableDataProps})},render:function(){var e="",a=this.props.options.type?this.props.options.type:"table";return this.props.entity&&(e=React.createElement(t,{className:this.state.isShowEntityDetail?"show":"hide",formId:"find-"+this.state.formId,backList:this.backList,entity:this.props.entity,entityData:this.state.entityData,currentPage:this.state.currentPage})),React.createElement("div",{className:"well"},React.createElement("form",{id:this.state.formId,className:this.state.isShowEntityDetail?"hide":"show"},this.state.searchbar,this.state.toolbar,React.createElement("div",{className:"tui-table-div"},React.createElement("table",{className:"tui-table tui-table-hover"},React.createElement(h,{columns:this.props.options.columns,checkAll:this.checkAll,isCheckAll:this.state.tableDataProps.isCheckAll}),React.createElement(u,_extends({rows:this.state.rows},this.state.tableDataProps,{handlerCheckForParent:this.handlerCheckForParent,deleteHandle:this.deleteHandle,findHandle:this.findHandle,refresh:this.refresh,type:a})))),this.state.pagination),e)}}),d=React.createClass({displayName:"SearchBar",dateFocus:function(t){e.datePicker(t,this.props.formId)},render:function(){var t="";return this.props.hasAdd&&(t=React.createElement("button",{type:"button",className:"ebtn ebtn-success ebtn-rounded",onClick:this.props.goCreate},React.createElement("i",{className:"fa fa-plus"})," 添加")),0===this.props.searchbar.length&&this.props.hasAdd?React.createElement("div",{className:"tui-searchbar"},React.createElement("div",{className:"form-group"},t)):this.props.searchbar.length>0?React.createElement("div",{className:"tui-searchbar"},this.props.searchbar.map(function(t,a){if("object"==typeof t){var r=t.type||"text",s="";switch(r){case"text":s=React.createElement("div",{className:"form-group",key:a},React.createElement("label",{htmlFor:t.field},t.text),React.createElement("input",{id:t.field,name:t.field,type:"text",ref:t.field,className:"form-control",placeholder:t.placeholder||t.text})," ");break;case"select":var n=t.options,i=[];if("string"==typeof n||n instanceof Array==!1){var l="object"==typeof n,o=l?n.url:n,c=l?n.textField:"text",d=l?n.valueField:"value";$.ajax({method:"GET",async:!1,url:o,success:function(e){i.push(React.createElement("option",{value:""},"不限"));for(var r=0;r<e.length;r++)i.push(React.createElement("option",{value:e[r][d]},e[r][c]));s=React.createElement("div",{className:"form-group",key:a},React.createElement("label",{htmlFor:t.field},t.text),React.createElement("select",{id:t.field,name:t.field,className:"form-control"},i)," ")},error:function(t,a,r){e.danger(o+"远程调用异常［"+a+", "+r+"］")}});break}i.push(React.createElement("option",{value:""},"不限"));for(var p=0;p<t.options.length;p++)i.push(React.createElement("option",{value:t.options[p].value},t.options[p].text));s=React.createElement("div",{className:"form-group",key:a},React.createElement("label",{htmlFor:t.field},t.text),React.createElement("select",{id:t.field,name:t.field,className:"form-control"},i)," ");break;case"radio":for(var n=[],p=0;p<t.options.length;p++)n.push(React.createElement("label",null,React.createElement("input",{type:"radio",name:t.field,value:t.options[p].value}),t.options[p].text));s=React.createElement("div",{className:"form-group",key:a},React.createElement("label",{htmlFor:t.field},t.text),n);break;case"date":s=React.createElement("div",{className:"form-group",key:a},React.createElement("label",{htmlFor:t.field},t.text),React.createElement("input",{id:t.field,name:t.field,type:"text",ref:t.field,className:"form-control",onFocus:this.dateFocus,onBlur:this.dateBlur,placeholder:t.placeholder||t.text})," ")}return s}return""}.bind(this)),React.createElement("div",{className:"form-group"}," ",React.createElement("button",{type:"button",className:"ebtn ebtn-primary ebtn-rounded",onClick:this.props._pagingClick,"data-page":"1"},React.createElement("i",{className:"fa fa-search"})," 查询")," ",React.createElement("button",{type:"reset",className:"ebtn ebtn-default ebtn-rounded"},"重置")," ",t)):React.createElement("div",{className:"tui-searchbar"})}}),p=React.createClass({displayName:"ToolBar",render:function(){return React.createElement("div",{className:"tui-toolbar"},this.props.toolbar.map(function(e,t){var a=e.type||"button",r="";switch(a){case"button":r=React.createElement("button",{className:(e.className?e.className:"btn btn-primary")+" tui-mr5",type:"button",onClick:e.handle},e.text);break;case"checkbox":var s=e.id||"",n=e.name||"";e.checked||!1;r=React.createElement("div",null,React.createElement("label",{htmlFor:s,className:"tui-mr5"},e.text),React.createElement("input",{type:"checkbox",id:s,name:n,style:{width:"15",height:"15"},defaultChecked:e.checked}));break;default:r=React.createElement("button",{className:(e.className?e.className:"btn btn-primary")+" tui-mr5",type:"button",onClick:e.handle},e.text)}return React.createElement("div",{className:"form-group"},r)}))}}),h=React.createClass({displayName:"TableColsComp",render:function(){return React.createElement("thead",{className:"tui-thead-default"},React.createElement("tr",null,this.props.columns.map(function(e,t){var a=e.text;return e.checkbox&&(a=React.createElement("input",{type:"checkbox",checked:this.props.isCheckAll,onChange:this.props._checkAll})),React.createElement("th",{key:t,style:{width:e.width?e.width:"auto"}},a)}.bind(this)),React.createElement("td",null)))}}),u=React.createClass({displayName:"TableData",componentWillReceiveProps:function(e){e.rows&&this.setState({tableTree:e.rows})},_checkAll:function(e){this.props.checkAll(e.target.checked)},parentClick:function(e){e.preventDefault();var t=e.currentTarget.dataset,a=-1===t.index.indexOf("-")?t.index:t.index.split("-"),r=t.hierarchy,s=this.state.tableTree,n="";if("string"==typeof a)if(n=s[a].tableTreeStatus||"hide","hide"===n)s[a].tableTreeStatus="tui-show";else{var i=s[a].children;if(s[a].tableTreeStatus="hide",i instanceof Array)for(var l=0;l<i.length;l++)i[l]&&(i[l].tableTreeChildStatus="hide")}else"2"==r?(n=s[a[0]].children[a[1]].tableTreeChildStatus||"hide","hide"===n?s[a[0]].children[a[1]].tableTreeChildStatus="tui-show":s[a[0]].children[a[1]].tableTreeChildStatus="hide"):(n=s[a[0]].children[a[1]].tableTreeStatus||"hide","hide"===n?s[a[0]].children[a[1]].tableTreeStatus="tui-show":s[a[0]].children[a[1]].tableTreeStatus="hide");this.setState({tableTree:s})},render:function(){if(!this.props.rows||!this.props.options)return React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,"正在加载数据...")));var e=this.props.type;return React.createElement("tbody",{className:"tui-tbody-default"},this.props.rows.map(function(t,a){t.isCheck=t.isCheck||!1;var r={type:e,row:t,rowHandles:this.props.options.rowHandles,columns:this.props.options.columns,index:a,handlerCheckForParent:this.props.handlerCheckForParent,deleteHandle:this.props.deleteHandle,findHandle:this.props.findHandle,refresh:this.props.refresh};if("table"===e)return React.createElement(m,_extends({key:a},r));if("tableTree"===e){var s={parentClick:this.parentClick};r.tableTreeProps=s;var n=[React.createElement(m,_extends({tableTreeStatus:this.state.tableTree[a].tableTreeStatus||"hide",hierarchy:1,isHighest:!0,isParent:!0,key:a},r))],i=t.children;if(i&&i instanceof Array)for(var l=0;l<i.length;l++)if(i[l]){var o=i[l].children;if(r.row=i[l],r.index=l,r.parentIndex=a,o&&o instanceof Array){n.push(React.createElement(m,_extends({tableTreeStatus:this.state.tableTree[a].tableTreeStatus||"hide",tableTreeChildStatus:this.state.tableTree[a].children[l].tableTreeChildStatus||"hide",hierarchy:2,isParent:!0,key:a+"-"+l},r)));for(var c=0;c<o.length;c++)o[c]&&(r.row=o[c],r.index=c,r.parentIndex=l,n.push(React.createElement(m,_extends({tableTreeStatus:this.state.tableTree[a].children[l].tableTreeChildStatus||"hide",hierarchy:3,key:a+"-"+l+"-"+c},r))))}else n.push(React.createElement(m,_extends({tableTreeStatus:this.state.tableTree[a].tableTreeStatus||"hide",key:a+"-"+l},r)))}return n}}.bind(this)))}}),m=React.createClass({displayName:"TableRow",getInitialState:function(){var e=this.props.tableTreeStatus;return{tableTreeProps:{status:e,parentStatusDOM:this.getParentStatusDOM(e)}}},componentWillReceiveProps:function(e){if("tableTree"===this.props.type&&(e.tableTreeStatus!==this.props.tableTreeStatus||e.tableTreeChildStatus!==this.props.tableTreeChildStatus)){var t=e.tableTreeStatus,a=2===this.props.hierarchy?e.tableTreeChildStatus:t,r={status:t,parentStatusDOM:this.getParentStatusDOM(a)};this.setState({tableTreeProps:r})}},getParentStatusDOM:function(e){return"hide"===e?React.createElement("span",null,React.createElement("i",{className:"fa fa-angle-right tui-mr5"}),React.createElement("i",{className:"fa fa-folder-open-o tui-mr5"})):React.createElement("span",null,React.createElement("i",{className:"fa fa-angle-down tui-mr5"}),React.createElement("i",{className:"fa fa-folder-open tui-mr5"}))},deleteHandle:function(t){t.preventDefault();var a=this.props.rowHandles;if(a&&"function"==typeof this.props.rowHandles["delete"]){var r=a["delete"](this.props.row);"object"==typeof r&&r.url?this.props.deleteHandle(r):e.danger("删除事件缺少返回值［url］")}else e.danger("请配置删除事件，参考属性［rowHandles.delete］")},findHandle:function(t){t.preventDefault();var a=this.props.rowHandles;if(a&&"function"==typeof this.props.rowHandles.find){var r=a.find(this.props.row);"object"==typeof r&&r.url?this.props.findHandle(r):e.danger("查看事件缺少返回值［url］")}else e.danger("请配置查看事件，参考属性［rowHandles.find］")},handlerCheck:function(){var e=!this.props.row.isCheck;this.props.handlerCheckForParent(this.props.index,e)},customHandles:function(e){e.preventDefault(),this.props.rowHandles.custom[e.currentTarget.dataset.customid].handle(this.props.row)},render:function(){var e=this.props.rowHandles,t=[],a=e?e.custom:[],r=[];if(isParent=this.props.isParent,isHighest=this.props.isHighest,parentDOM="tableTree"===this.props.type?React.createElement("td",null):void 0,isParent&&(parentDOM=React.createElement("a",{href:"javascript:;",onClick:this.props.tableTreeProps.parentClick,"data-index":"number"==typeof this.props.parentIndex?this.props.parentIndex+"-"+this.props.index:this.props.index,"data-hierarchy":this.props.hierarchy},this.state.tableTreeProps.parentStatusDOM)),e){if("function"==typeof e.find&&t.push(React.createElement("a",{href:"javascript:;",className:"tui-mr5",title:"详情",onClick:this.findHandle},React.createElement("i",{className:"fa fa-edit fa-lg"}))),e.custom&&a instanceof Array)for(var s=0;s<a.length;s++){var n=a[s];r.push(React.createElement("li",null,React.createElement("a",{href:"javascript:;",onClick:this.customHandles,"data-customid":s},React.createElement("i",{className:n.iconClass?n.iconClass:""})," ",n.text)))}"function"==typeof e["delete"]&&r.push(React.createElement("li",null,React.createElement("a",{href:"javascript:;",className:"tui-mr5",title:"删除",onClick:this.deleteHandle,style:{marginRight:"5px"}},React.createElement("i",{className:"fa fa-trash-o fa-fw"})," 删除"))),r.length>0&&t.push(React.createElement("div",{className:"btn-group"},React.createElement("a",{href:"javascript:;",className:"dropdown-toggle tui-dropdown-menu","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"更多 ",React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu tui-dropdown-menu"},r)))}return React.createElement("tr",{key:this.props.index,"data-parent":3===this.props.hierarchy?"child_"+this.props.parentIndex:"number"==typeof this.props.parentIndex?"parent_"+this.props.parentIndex:"",className:"table"===this.props.type||isHighest?"":this.state.tableTreeProps?this.state.tableTreeProps.status:""},this.props.columns.map(function(e,t){var a=this.props.row,r=0===t&&isParent?parentDOM:"";if(!e.handle&&-1===e.field.indexOf(".")&&!e.checkbox)return React.createElement("td",{key:t},r,a[e.field]);if("function"==typeof e.handle){if(r=e.handle(a),void 0===r&&console.error('TUI Table column["'+e.field+'"] is no return value.'),!e.field){var s={__html:r};return React.createElement("td",{key:t,dangerouslySetInnerHTML:s})}return React.createElement("td",{key:t},r)}if(e.field.indexOf(".")>0){var n=e.field.split("."),i="";try{for(var l=0;l<n.length;l++)i=0===l?a[n[l]]:i[n[l]];return React.createElement("td",{key:t},r,i)}catch(o){return React.createElement("td",{key:t})}}else if(e.checkbox)return React.createElement("td",{key:t},React.createElement("input",{type:"checkbox",name:e.field,value:a[e.field],checked:a.isCheck,onChange:this.handlerCheck}))}.bind(this)),React.createElement("td",null,t))}}),f=React.createClass({displayName:"Pagination",changeMaxSize:function(){this.props.changeMaxSize(this.refs.maxSize.value)},render:function(){var e=Number(this.props.rowCount)||0,t=Number(this.props.currentPage),a=this.props.maxSize,r=5,s=e%a===0?e/a:parseInt(e/a)+1,n=[],i=1,l=s+1;s>r&&(t-5>=0?(i=t-2,l=t+2,t>=s-3&&(i=s-r+1,l=s),n.push(React.createElement("li",{key:1},React.createElement("a",{href:"javascript:;",onClick:this.props._pagingClick,"data-page":1},1,"..."))),l++):l=r+1);for(var o=i;l>o;o++){var c=React.createElement("li",{key:o},React.createElement("a",{href:"javascript:;",onClick:this.props._pagingClick,"data-page":o},o));o===t&&(c=React.createElement("li",{key:o,className:"active"},React.createElement("a",{href:"javascript:;"},o))),n.push(c)}return s-t>3&&n.push(React.createElement("li",{key:s},React.createElement("a",{href:"javascript:;",onClick:this.props._pagingClick,"data-page":s},"...",s))),React.createElement("nav",null,React.createElement("ul",{className:"pager"},React.createElement("li",null,React.createElement("small",{style:{marginRight:"10px"}},React.createElement("span",null,"共有 ",e," 条,每页显示 ",React.createElement("select",{ref:"maxSize",defaultValue:a,onChange:this.changeMaxSize},React.createElement("option",{value:"10"},"10"),React.createElement("option",{value:"15"},"15"),React.createElement("option",{value:"20"},"20"),React.createElement("option",{value:"30"},"30"),React.createElement("option",{value:"50"},"50"),React.createElement("option",{value:"100"},"100"))," 条"))),React.createElement("li",null,React.createElement("a",{href:"javascript:;",style:{padding:"2px 7px"},onClick:1===t||t-1===0?"":this.props._pagingClick,"data-page":t-1},React.createElement("i",{className:"fa fa-arrow-left"}))),n,React.createElement("li",null,React.createElement("a",{href:"javascript:;",style:{padding:"2px 7px"},onClick:t===s||t+1>s?"":this.props._pagingClick,"data-page":t+1},React.createElement("i",{className:"fa fa-arrow-right"})))))}}),y=function(t){try{t.options||(t=2===arguments.length?{options:arguments[0],entity:arguments[1]}:{options:arguments[0]});var a=t.options,r=a.container,s=document.getElementById(r);if(s){var n=a.formId||"tui-"+Math.random().toString(36).substr(2),i=function(){var e=a.searchbar,r=[],s={hasAdd:t.entity&&t.entity.create?!0:!1};if(e instanceof Array&&e.length>0){for(var i=0;i<e.length;i++)"object"==typeof e[i]&&e[i].field&&r.push({field:e[i].field,type:e[i].type||"text"});s.searchbar=e,s.searchbarCols=r,s.formId=n}else s.searchbar=[];return{searchbarProps:s,searchbarCols:r}},l=function(){var e=a.toolbar,t={};return e instanceof Array&&e.length>0?t.toolbar=e:t.toolbar=[],{toolbarProps:t}};t.searchbar=i(),t.toolbar=l(),t.options.formId=n,ReactDOM.render(React.createElement(c,t),document.getElementById(r))}else e.danger("目标容器["+r+"]不存在"),console.error("目标容器["+r+"]不存在")}catch(o){e.danger("初始化Table错误,请检查参数"),console.error("初始化Table错误,请检查参数")}},b=React.createClass({displayName:"ModalComp",confirm:function(){"success"===this.props.confirm()&&$("#"+this.props.id).modal("hide")},render:function(){var e={__html:this.props.content},t="";return"function"==typeof this.props.confirm&&(t=React.createElement("button",{type:"button",className:"ebtn ebtn-success ebtn-rounded",onClick:this.confirm},"确定")),React.createElement("div",{id:this.props.id,className:"modal fade",tabIndex:"-1",role:"dialog","aria-labelledby":this.props.id+"Label","aria-hidden":"true"},React.createElement("div",{className:"modal-dialog "+this.props.type,role:"document"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},"×"),React.createElement("span",{className:"sr-only"},"Close")),React.createElement("h4",{className:"modal-title",id:this.props.id+"Label"},this.props.title)),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"row"},React.createElement("div",{
className:"col-md-12",dangerouslySetInnerHTML:e}))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"ebtn ebtn-default ebtn-rounded","data-dismiss":"modal"},"取消")," ",t))))}}),v=function(e){var t=document.getElementById("tui-modal-container");if("string"==typeof e.type)switch(e.type){case"lg":e.type="modal-lg";break;case"sm":e.type="modal-sm";break;default:e.type=""}var a={id:e.id||"tui-modal-"+Math.random().toString(36).substr(2),type:e.type||"",title:e.title||"模态框",content:e.content||"",confirm:e.confirm,className:"show"};t||(t=document.createElement("div"),t.id="tui-modal-container",document.body.appendChild(t)),ReactDOM.render(React.createElement(b,a),t),setTimeout(function(){$("#"+a.id).modal("show")},100)},g=React.createClass({displayName:"AlertModal",render:function(){return React.createElement("span",{className:this.props.type},this.props.msg)}}),E=function(e){var t=document.createElement("div");t.className="tui-alert-modal",document.body.appendChild(t),ReactDOM.render(React.createElement(g,{type:e.type,msg:e.msg}),t),setTimeout(function(){t.className="hide",document.body.removeChild(t)},3800)},R=function(e){this.Alert({type:"success",msg:e})},k=function(e){this.Alert({type:"danger",msg:e})},N=function(e){this.Alert({type:"warning",msg:e})},C=function(e){this.Alert({type:"info",msg:e})},x=React.createClass({displayName:"LoadingModal",render:function(){return React.createElement("div",{className:"tui-loading-parent "+this.props.className},React.createElement("div",{className:"tui-loading"},React.createElement("span",{className:"text"},this.props.text," ",React.createElement("i",{className:"fa fa-spinner fa-spin fa-lg"}))))}}),w=function(e){var t=document.getElementsByClassName("tui-loading-container"),a="";0===t.length?(a=document.createElement("div"),a.className="tui-loading-container",document.body.appendChild(a)):a=t[0],ReactDOM.render(React.createElement(x,{className:e&&e.className?e.className:"show",text:e&&e.text?e.text:"正在加载"}),a)},S={dateFormat:function(e,t){if(e){var a=new Date(e),t=t||"",r=a.getYear()+1900,s=1==(a.getMonth()+1+"").length?"0"+(a.getMonth()+1):a.getMonth()+1,n=1==(a.getDate()+"").length?"0"+a.getDate():a.getDate(),i=1==(a.getHours()+"").length?"0"+a.getHours():a.getHours(),l=1==(a.getMinutes()+"").length?"0"+a.getMinutes():a.getMinutes(),o=1==(a.getSeconds()+"").length?"0"+a.getSeconds():a.getSeconds(),c="";switch(t.toLowerCase()){case"yyyy-mm-dd hh:mm:ss":c=r+"-"+s+"-"+n+"   "+i+":"+l+":"+o;break;case"yyyy-mm-dd":c=r+"-"+s+"-"+n;break;default:c=r+"-"+s+"-"+n+"   "+i+":"+l+":"+o}return c}return""},getElementLeft:function(e){e=e.target;for(var t=e.offsetLeft,a=e.offsetParent;null!==a;)t+=a.offsetLeft,a=a.offsetParent;return t},getElementTop:function(e){e=e.target;for(var t=e.offsetTop,a=e.offsetParent;null!==a;)t+=a.offsetTop,a=a.offsetParent;return t}},T=function(t){try{t.options.refresh=!0,y(t)}catch(a){e.danger("TUI tableRefresh 异常，"+a),console.error("TUI tableRefresh 异常，"+a)}};e.table=y,e.tableRefresh=T,e.Modal=v,e.modal=v,e.Alert=E,e.success=R,e.danger=k,e.warning=N,e.info=C,e.Loading=w,e.loading=w,e.Utils=S,e.config={simditor:{url:"/upload"}},"undefined"!=typeof module&&"object"==typeof exports?module.exports=e:"function"==typeof define&&(define.amd||define.cmd)?define(function(){return e}):window.TUI=e}).call(function(){return this||("undefined"!=typeof window?window:global)}),function(){var e=React.createClass({displayName:"DatePickerComp",getInitialState:function(){var e=new Date;return{className:"show",year:e.getFullYear(),month:e.getMonth()+1,daysObj:[]}},componentDidMount:function(){this.isMounted()&&this.setState({daysObj:this.renderDays()})},componentWillReceiveProps:function(e){e.className&&e.className.length>0&&this.setState({className:e.className})},getMonthDays:function(e,t){var a=0;return a=2===t?e%4===0?29:28:1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:30},renderDays:function(e,t){e=e||this.state.year,t=t||this.state.month;for(var a=new Date(e+"-"+t+"-1"),r=this.getMonthDays(e,t),s=a.getDay(),n=[],i=[],l=0;s>l;l++)i.push("");for(var l=1;r+1>l;l++)i.push(l),7===i.length&&(n.push({daysArr:i}),i=[]),l===r&&n.push({daysArr:i});return n},setDate:function(e){if(e.preventDefault(),""!==e.target.dataset.day){var t=this.state.year+"-"+this.state.month+"-"+e.target.dataset.day;$("#"+this.props.formId).find("#"+this.props.target.id).val(t),this.setState({className:"hide"})}},prevMonth:function(e){e.preventDefault();var t=this.state.year,a=this.state.month;a-1===0?(t--,a=12):a--,this.setState({year:t,month:a,daysObj:this.renderDays(t,a)})},nextMonth:function(e){e.preventDefault();var t=this.state.year,a=this.state.month;a+1===13?(t++,a=1):a++,this.setState({year:t,month:a,daysObj:this.renderDays(t,a)})},close:function(e){e.preventDefault(),this.setState({className:"hide"})},render:function(){return React.createElement("div",{className:"panel panel-default "+this.state.className},React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"tui-datepicker-head"},React.createElement("a",{onClick:this.prevMonth,href:"javascript:;",className:"pull-left",style:{padding:"8",margin:"8px 0",lineHeight:"0"}},React.createElement("i",{className:"fa fa-arrow-left"})),React.createElement("a",{href:"javascript:;",style:{padding:"8px 50px"}},this.state.month+"月"," ",this.state.year),React.createElement("a",{onClick:this.nextMonth,href:"javascript:;",className:"pull-right",style:{padding:"8",margin:"8px 0",lineHeight:"0"}},React.createElement("i",{className:"fa fa-arrow-right"}))),React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Su"),React.createElement("th",null,"Mo"),React.createElement("th",null,"Tu"),React.createElement("th",null,"We"),React.createElement("th",null,"Th"),React.createElement("th",null,"Fr"),React.createElement("th",null,"Sa"))),React.createElement("tbody",null,this.state.daysObj.map(function(e,t){for(var a=[],r=e.daysArr,s=0;s<r.length;s++)a.push(React.createElement("td",{key:s,"data-day":r[s],onClick:this.setDate},React.createElement("a",{"data-day":r[s],href:"javascript:;"},r[s])));return React.createElement("tr",{key:t},a)}.bind(this)))),React.createElement("div",{className:"tui-datepicker-foot"},React.createElement("a",{href:"javascript:;",onClick:this.close},React.createElement("i",{className:"fa fa-close fa-lg"})))))}}),t=function(t,a){var r=document.getElementById("tui-datepicker");r||(r=document.createElement("div"),r.id="tui-datepicker",r.className="tui-datepicker",document.body.appendChild(r)),r.style.display="block",$("#tui-datepicker").offset({top:TUI.Utils.getElementTop(t)+t.target.offsetHeight,left:TUI.Utils.getElementLeft(t)}),ReactDOM.render(React.createElement(e,{formId:a,className:"show",target:t.target}),r)};TUI.datePicker=t}();